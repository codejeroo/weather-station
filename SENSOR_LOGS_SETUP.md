# Sensor Logs Setup Guide

## Database Table Creation

To create the `sensor_logs` table in your Supabase database, follow these steps:

### 1. Access Supabase Dashboard
- Go to your Supabase project at https://app.supabase.com
- Navigate to the **SQL Editor**

### 2. Run the SQL Query
Copy and paste the following SQL into the SQL Editor and execute it:

```sql
create table public.sensor_logs (
  id bigint generated by default as identity not null,
  node_id text not null,
  temperature double precision null,
  humidity double precision null,
  pressure double precision null,
  altitude double precision null,
  soil_moisture double precision null,
  created_at timestamp with time zone null default now(),
  constraint sensor_logs_pkey primary key (id)
) TABLESPACE pg_default;
```

### 3. Enable Row Level Security (Optional but Recommended)
If you want to add security policies:

```sql
-- Enable RLS on the table
ALTER TABLE public.sensor_logs ENABLE ROW LEVEL SECURITY;

-- Allow anyone to read the data (adjust as needed)
CREATE POLICY "Enable read access for all users" ON public.sensor_logs
  FOR SELECT USING (true);

-- Allow authenticated users to insert (adjust as needed)
CREATE POLICY "Enable insert for authenticated users" ON public.sensor_logs
  FOR INSERT WITH CHECK (auth.role() = 'authenticated');
```

## Frontend Integration

The frontend is already set up with:

1. **sensorLogs.js** - Utility file with functions to:
   - Fetch sensor logs
   - Fetch logs by node
   - Insert new sensor logs
   - Subscribe to real-time updates

2. **SensorLogsTable.jsx** - Component that displays the sensor logs in a table format

3. **Dashboard.jsx** - Updated to show the sensor logs table

## Testing the Setup

### Insert Test Data
To test your setup, insert sample data using the Supabase SQL Editor:

```sql
INSERT INTO public.sensor_logs (node_id, temperature, humidity, pressure, altitude, soil_moisture)
VALUES 
  ('NODE-001', 22.5, 65, 1013.25, 100, 45.2),
  ('NODE-002', 21.8, 70, 1013.10, 95, 48.5),
  ('NODE-001', 23.1, 62, 1013.30, 100, 42.8);
```

### Access the Dashboard
1. Make sure your development server is running (`npm run dev`)
2. Navigate to the Dashboard page
3. You should see the sensor logs table at the bottom displaying the data

## API Functions Available

### fetchSensorLogs(limit)
Fetches the latest sensor logs
```javascript
import { fetchSensorLogs } from '@/utils/sensorLogs'
const logs = await fetchSensorLogs(50)
```

### fetchSensorLogsByNode(nodeId, limit)
Fetches logs for a specific sensor node
```javascript
const logs = await fetchSensorLogsByNode('NODE-001', 100)
```

### insertSensorLog(sensorData)
Inserts a new sensor log
```javascript
const newLog = await insertSensorLog({
  node_id: 'NODE-001',
  temperature: 25.5,
  humidity: 60,
  pressure: 1013.25
})
```

### subscribeSensorLogs(callback)
Subscribes to real-time updates (advanced)
```javascript
const unsubscribe = subscribeSensorLogs((payload) => {
  console.log('New data:', payload)
})
```

## Troubleshooting

- **No data showing?** Check that you've created the table and inserted test data
- **CORS errors?** Ensure your Supabase API keys are correctly set in `.env.local`
- **Connection issues?** Verify your `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY` environment variables
